---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import { getVotes, type VoteData } from '../utils/votes';

const currentYear = new Date().getFullYear();
const allApps = await getCollection('apps');
const votes: VoteData = getVotes();

// Sort apps by vote count (descending)
const sortedApps = allApps.sort((a, b) => {
  const votesA = votes[a.data.name]?.votes || 0;
  const votesB = votes[b.data.name]?.votes || 0;
  return votesB - votesA;
});
---

<Layout>
  <main class="min-h-screen bg-gradient-to-b from-purple-900 via-blue-900 to-black text-white">
    <div class="sticky top-0 z-50 backdrop-blur-sm py-4">
      <div class="flex justify-center">
        <div
          class="group bg-gradient-to-r from-purple-500/20 to-blue-500/20 rounded-lg px-6 py-3 backdrop-blur-sm border border-white/10 flex items-center gap-3 transition-all duration-500 ease-in-out hover:gap-6 cursor-pointer peer"
        >
          <div class="flex items-center gap-1 min-w-max">
            <span class="text-white/90 text-sm">Sponsored by</span>
            <span class="font-bold text-white text-sm">hungrimind</span>
          </div>
          
          <div class="max-w-0 overflow-hidden group-hover:max-w-[800px] peer-focus:max-w-[800px] transition-all duration-500 ease-in-out flex items-center gap-3">
            <span class="text-white/80 opacity-0 group-hover:opacity-100 peer-focus:opacity-100 transition-opacity duration-500 delay-150">·</span>
            <span class="text-white/80 text-sm whitespace-nowrap opacity-0 group-hover:opacity-100 peer-focus:opacity-100 transition-opacity duration-500 delay-150">Click here to get The Best Flutter Course on the Internet</span>
            <a
              href="https://hungrimind.com"
              class="bg-gray-900/60 hover:bg-gray-900/80 text-white px-4 py-1.5 rounded-full text-sm font-medium transition-colors flex items-center gap-1 whitespace-nowrap opacity-0 group-hover:opacity-100 peer-focus:opacity-100 transition-opacity duration-500 delay-150"
            >
              Enroll Now
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Hero Section -->
    <div class="relative overflow-hidden">
      <div class="absolute inset-0">
        <div
          class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4xIj48cGF0aCBkPSJNMzYgMzBoLTJ2Mmgydi0yem0tMjAgMGgydjJoLTJ2LTJ6bTIwLTIwdi0yaDJ2MmgtMnptLTIwIDBoMnYyaC0ydi0yeiIvPjwvZz48L2c+PC9zdmc+')] opacity-10"
        >
        </div>
      </div>
      <div class="container mx-auto px-4 pt-8 pb-24 relative">
        <div class="text-center max-w-4xl mx-auto">
          <h1
            class="text-6xl font-bold mb-8 text-white"
          >
            The Best Flutter Apps of {currentYear} <span class="inline-block animate-sparkle">✨</span>
          </h1>
          <p class="text-lg text-blue-200/80 max-w-3xl mx-auto mb-16">
            The Best is an arbitrary phrase and means different things to different people. Vote for the apps that you like the most, that solve the most interesting problem. Whatever your definition of The Best is, go with that for your votes. You can also vote for multiple apps.
          </p>
        </div>

<<<<<<< Updated upstream
        <!-- Submit CTA -->
        <div class="max-w-xl mx-auto mb-8">
          <div
            class="bg-white/5 backdrop-blur-lg rounded-xl p-5 border border-white/10 hover:bg-white/10 transition-colors duration-300"
          >
            <h2 class="text-lg font-bold mb-2">Built Something Amazing?</h2>
            <p class="text-blue-200/90 text-sm mb-3">
              Share your Flutter app with the community and showcase your work in the Flutter of the
              Year collection!
            </p>
            <a
              href="https://github.com/hungrimind/flutter-of-the-year"
              class="inline-block bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-2 px-5 rounded-full transition-all duration-300 hover:scale-105 text-sm"
            >
              Submit Your App
            </a>
          </div>
=======
        <!-- Apps Grid -->
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {sortedApps.map((app) => (
                    <div class="bg-white/10 backdrop-blur-lg rounded-xl overflow-hidden border border-white/20">
                        <div class="p-6">
                            <!-- App Screenshots -->
                            <!-- App Screenshots Carousel -->
                            <div class="relative w-full mx-auto mb-6">
                                <div class="overflow-x-auto scrollbar-hide snap-x snap-mandatory flex gap-4 h-96">
                                    {app.data.images ? (
                                        app.data.images.map((image, idx) => (
                                            <div class="flex-none w-48 h-full snap-center">
                                                <div class="h-full rounded-lg overflow-hidden shadow-lg ring-4 ring-purple-500/30">
                                                    <Image 
                                                        src={image}
                                                        alt={`${app.data.name} screenshot ${idx + 1}`}
                                                        width={400}
                                                        height={711}
                                                        class="w-full h-full object-cover"
                                                    />
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        <div class="flex-none w-48 h-full snap-center">
                                            <div class="w-full h-full flex items-center justify-center bg-gray-800 text-gray-400 text-sm text-center px-2 rounded-lg">
                                                Mobile Screenshot Required (9:16)
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <!-- Image Indicators -->
                                {app.data.images && app.data.images.length > 1 && (
                                    <div class="flex justify-center gap-1.5 mt-4">
                                        {app.data.images.map((_, index) => (
                                            <button 
                                                class="w-2 h-2 rounded-full bg-white/50 hover:bg-white/70 transition-colors"
                                                onclick={`this.parentElement.parentElement.querySelector('.overflow-x-auto').scrollTo({
                                                    left: ${index * 192}, 
                                                    behavior: 'smooth'
                                                })`}
                                            />
                                        ))}
                                    </div>
                                )}
                            </div>
                            <!-- App Info -->
                            <div class="text-center space-y-3 mb-4">
                                <div>
                                    <h2 class="text-xl font-bold">{app.data.name}</h2>
                                    <p class="text-blue-200 text-sm mt-1">by {app.data.author}</p>
                                </div>
                                
                                <a 
                                    href={`https://github.com${votes[app.data.name]?.slug}`}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="inline-flex items-center gap-2 text-orange-400 hover:text-orange-300 transition-all group px-3 py-1"
                                >
                                    <svg class="w-6 h-6 group-hover:-translate-y-0.5 transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 19V5M5 12l7-7 7 7" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span class="text-lg font-medium">{votes[app.data.name]?.votes}</span>
                                </a>
                            </div>

                            <!-- App Description -->
                            <p class="text-gray-300 text-sm mb-6 text-center">{app.data.description}</p>

                            <!-- App Links -->
                            <div class="flex justify-center gap-4">
                                {app.data.platforms.map((platform) => (
                                    <a 
                                        href={platform.url}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="text-blue-400 hover:text-blue-300 transition-colors px-3 py-1 border border-blue-400/30 rounded-full text-sm"
                                    >
                                        {platform.name}
                                    </a>
                                ))}
                            </div>
                        </div>
                    </div>
                ))}
            </div>
>>>>>>> Stashed changes
        </div>
      </div>
    </div>

    <!-- Apps Grid -->
    <div class="container mx-auto px-4 py-16">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          sortedApps.map((app) => (
            <div class="group bg-white/10 backdrop-blur-lg rounded-xl overflow-hidden border border-white/20 hover:border-white/30 transition-all duration-300 hover:shadow-lg hover:shadow-purple-500/10 hover:-translate-y-1">
              <div class="p-6">
                {/* App Screenshots */}
                <div class="w-48 aspect-[8/16] mx-auto mb-6 rounded-lg overflow-hidden shadow-lg ring-4 ring-purple-500/30 group-hover:ring-purple-500/40 transition-all duration-300">
                  {app.data.images ? (
                    <Image
                      src={app.data.images[0]}
                      alt={`${app.data.name} screenshot`}
                      width={400}
                      height={711}
                      class="w-full h-full object-cover"
                    />
                  ) : (
                    <div class="w-full h-full flex items-center justify-center bg-gray-800 text-gray-400 text-sm text-center px-2">
                      Mobile Screenshot Required (9:16)
                    </div>
                  )}
                </div>

                {/* Image Indicators if multiple images */}
                {app.data.images && app.data.images.length > 1 && (
                  <div class="flex justify-center gap-1 mb-4">
                    {app.data.images.map((_, index) => (
                      <div class="w-1.5 h-1.5 rounded-full bg-white/50" />
                    ))}
                  </div>
                )}

                {/* App Info */}
                <div class="text-center space-y-4 mb-6">
                  <div>
                    <h2 class="text-xl font-bold group-hover:text-blue-200 transition-colors">{app.data.name}</h2>
                    <p class="text-blue-200/80 text-sm mt-2">by {app.data.author}</p>
                  </div>

                  <a
                    href={`https://github.com${votes[app.data.name]?.slug}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="inline-flex items-center gap-2 text-orange-400 hover:text-orange-300 transition-all group px-4 py-1.5 rounded-full hover:bg-orange-400/10"
                  >
                    <svg
                      class="w-6 h-6 group-hover:-translate-y-0.5 transition-transform"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M12 19V5M5 12l7-7 7 7"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                    <span class="text-lg font-medium">{votes[app.data.name]?.votes}</span>
                  </a>
                </div>

                {/* App Description */}
                <p class="text-gray-300 text-sm mb-6 text-center">{app.data.description}</p>

                {/* App Links */}
                <div class="flex justify-center gap-4">
                  {app.data.platforms.map((platform) => (
                    <a
                      href={platform.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-blue-400 hover:text-blue-300 transition-colors px-3 py-1 border border-blue-400/30 rounded-full text-sm"
                    >
                      {platform.name}
                    </a>
                  ))}
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </main>
</Layout>

<style>
  @keyframes float {
    0% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-10px);
    }
    100% {
      transform: translateY(0px);
    }
  }

  @keyframes sparkle {
    0%, 100% {
      transform: scale(1) rotate(0deg);
    }
    50% {
      transform: scale(1.2) rotate(10deg);
    }
  }

<<<<<<< Updated upstream
  .animate-sparkle {
    animation: sparkle 2s ease-in-out infinite;
  }

  :root {
    --color-gold: #ffd700;
    --color-silver: #c0c0c0;
    --color-bronze: #a87333;
  }

  .text-gold {
    color: var(--color-gold);
  }
  .text-silver {
    color: var(--color-silver);
  }
  .text-bronze {
    color: var(--color-bronze);
  }

  .border-gold {
    border-color: var(--color-gold);
  }
  .border-silver {
    border-color: var(--color-silver);
  }
  .border-bronze {
    border-color: var(--color-bronze);
  }
=======
    .border-gold { border-color: var(--color-gold); }
    .border-silver { border-color: var(--color-silver); }
    .border-bronze { border-color: var(--color-bronze); }

    /* Hide scrollbar but keep functionality */
    .scrollbar-hide {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;     /* Firefox */
    }
    .scrollbar-hide::-webkit-scrollbar {
        display: none;            /* Chrome, Safari and Opera */
    }
>>>>>>> Stashed changes
</style>
